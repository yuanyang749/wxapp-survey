<!--投票创建页面-->
<view class="page {{!loading?'pageShow':''}}">
  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">初始化中...</text>
  </view>

  <!-- 主要内容 -->
  <scroll-view wx:else scroll-y style="height:100vh" class="content-container">

    <!-- 错误提示 -->
    <view wx:if="{{showError}}" class="error-toast">
      <text class="error-text">{{errorMessage}}</text>
    </view>

    <!-- 基本信息 -->
    <view class="form-section">
      <view class="section-title">基本信息</view>

      <view class="form-item">
        <view class="item-label">投票标题 *</view>
        <input
          class="item-input"
          placeholder="请输入投票标题"
          maxlength="100"
          value="{{title}}"
          bindinput="onTitleInput" />
      </view>

      <view class="form-item">
        <view class="item-label">投票描述</view>
        <textarea
          class="item-textarea"
          placeholder="请输入投票描述（选填）"
          maxlength="500"
          value="{{description}}"
          bindinput="onDescriptionInput" />
        <view class="char-count">{{description.length}}/500</view>
      </view>
    </view>
    <!-- 投票选项 -->
    <view class="form-section">
      <view class="section-title">投票选项</view>

      <view class="options-container">
        <block wx:for="{{options}}" wx:key="order" wx:for-index="index">
          <view class="option-item">
            <view class="option-number">{{index + 1}}</view>
            <input
              class="option-input"
              placeholder="请输入选项内容"
              maxlength="100"
              value="{{item.text}}"
              data-index="{{index}}"
              bindinput="onOptionInput" />
            <view
              wx:if="{{options.length > minOptions}}"
              class="option-delete"
              data-index="{{index}}"
              bindtap="deleteOption">
              <image src="/images/icon-del.png" class="delete-icon"></image>
            </view>
          </view>
        </block>

        <view
          wx:if="{{options.length < maxOptions}}"
          class="add-option-btn"
          bindtap="addOption">
          <image src="/images/icon-add3.png" class="add-icon"></image>
          <text class="add-text">添加选项（{{minOptions}}-{{maxOptions}}项）</text>
        </view>
      </view>
    </view>

    <!-- 封面图片 -->
    <view class="form-section">
      <view class="section-title">封面图片</view>

      <view wx:if="{{!coverImage}}" class="upload-cover-btn" bindtap="chooseCoverImage">
        <image src="/images/icon-add3.png" class="upload-icon"></image>
        <text class="upload-text">添加封面图片（选填）</text>
      </view>

      <view wx:else class="cover-preview">
        <image
          src="{{coverImage}}"
          mode="aspectFill"
          class="cover-image"
          bindtap="previewCoverImage" />
        <view class="cover-actions">
          <button class="action-btn" bindtap="chooseCoverImage">更换</button>
          <button class="action-btn delete" bindtap="deleteCoverImage">删除</button>
        </view>
      </view>
    </view>
    <!-- 投票设置 -->
    <view class="form-section">
      <view class="section-title">投票设置</view>

      <view class="setting-item">
        <view class="setting-label">投票类型</view>
        <radio-group class="radio-group" bindchange="onSurveyTypeChange">
          <label class="radio-item">
            <radio value="single_choice" checked="{{surveyType === 'single_choice'}}" color="#5f1971" />
            <text class="radio-text">单选</text>
          </label>
          <label class="radio-item">
            <radio value="multiple_choice" checked="{{surveyType === 'multiple_choice'}}" color="#5f1971" />
            <text class="radio-text">多选</text>
          </label>
        </radio-group>
      </view>

      <view class="setting-item">
        <view class="setting-label">访问权限</view>
        <radio-group class="radio-group" bindchange="onAccessLevelChange">
          <label class="radio-item">
            <radio value="public" checked="{{accessLevel === 'public'}}" color="#5f1971" />
            <text class="radio-text">完全公开</text>
          </label>
          <label class="radio-item">
            <radio value="authenticated" checked="{{accessLevel === 'authenticated'}}" color="#5f1971" />
            <text class="radio-text">登录可见</text>
          </label>
          <label class="radio-item">
            <radio value="owner_only" checked="{{accessLevel === 'owner_only'}}" color="#5f1971" />
            <text class="radio-text">仅自己</text>
          </label>
        </radio-group>
      </view>

      <view class="setting-item">
        <view class="setting-label">截止时间</view>
        <view class="datetime-picker">
          <picker
            mode="date"
            value="{{endTime}}"
            start="{{currentDate}}"
            end="{{maxDate}}"
            bindchange="onDateChange">
            <view class="picker-display">{{endTime || '选择日期'}}</view>
          </picker>
          <picker
            mode="time"
            value="{{currentTime}}"
            bindchange="onTimeChange">
            <view class="picker-display">{{currentTime}}</view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-container">
      <button
        class="submit-btn {{submitting ? 'submitting' : ''}}"
        bindtap="onSubmit"
        disabled="{{submitting}}">
        <text wx:if="{{submitting}}">发布中...</text>
        <text wx:else>发布投票</text>
      </button>
    </view>

  </scroll-view>
</view>