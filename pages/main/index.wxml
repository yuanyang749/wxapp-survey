<!-- pages/main/index.wxml -->
<view class="page {{!loading?'pageShow':''}}">
  <!-- 骨架屏加载状态 -->
  <view wx:if="{{loading}}" class="skeleton-wrapper">
    <!-- 轮播图骨架屏 -->
    <view class="banner-skeleton">
      <view class="skeleton-banner"></view>
    </view>
    <!-- 用户状态栏骨架屏 -->
    <skeleton type="profile" show="{{true}}" animated="{{true}}"></skeleton>
    <!-- 投票列表骨架屏 -->
    <skeleton type="card" show="{{true}}" rows="{{3}}" animated="{{true}}"></skeleton>
  </view>
  <!-- 主要内容 -->
  <scroll-view wx:else scroll-y class="main-scroll-view" bindscroll="onScroll" scroll-with-animation='true' enable-back-to-top='true' scroll-top='{{scrollTop}}' bindscrolltolower="onReachBottom">
    <!-- 轮播图 -->
    <swiper wx:if="{{bannerUrls.length > 0}}" indicator-dots="{{indicatorDots}}" autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
      <block wx:for="{{bannerUrls}}" wx:for-index="idx">
        <swiper-item class='swiper-item'>
          <view class="slide-image" style="background-image:url({{item}})"></view>
          <view class="slide-title">{{bannerTxt[idx]}}</view>
        </swiper-item>
      </block>
    </swiper>
    <!-- 标签栏 -->
    <view class="name-box {{typeNameFixed?'fixed':''}}">
      <view bindtap="onTabChange" data-type-name='new' class="type-name {{activeTab==='new'?'on':''}}">
        最新投票
      </view>
      <view bindtap="onTabChange" data-type-name='hot' class="type-name {{activeTab==='hot'?'on':''}}">
        热门投票
      </view>
      <view class="realBorder {{activeTab}}"></view>
    </view>
    <!-- 投票列表 -->
    <view class="survey-list">
      <block wx:if="{{surveys.length > 0}}">
        <block wx:for="{{surveys}}" wx:key="id" wx:for-item="survey">
          <view class="survey-card" bindtap="onSurveyTap" data-survey="{{survey}}">
            <!-- 投票封面 -->
            <view class="survey-cover" style="background-image:url({{survey.cover_image_url || survey.defaultCover}})">
              <!-- 置顶标识 -->
              <view wx:if="{{survey.is_featured}}" class="featured-badge">置顶</view>
              <!-- 访问级别标识 -->
              <view wx:if="{{survey.access_level === 'authenticated'}}" class="access-badge">
                <image src="/images/icon-sq.png" class="lock-icon"></image>
              </view>
              <!-- 标题覆盖层 -->
              <view class="title-overlay">
                <view class="survey-title">{{survey.title}}</view>
              </view>
            </view>
            <!-- 投票信息 -->
            <view class="survey-info">
              <!-- 创建者信息 -->
              <view class="creator-section">
                <image class="creator-avatar" src="{{survey.creator_avatar || survey.defaultAvatar}}" mode="aspectFill"></image>
                <text class="creator-name">{{survey.creator_name || '匿名用户'}}</text>
              </view>
              <!-- 统计信息 -->
              <view class="stats-section">
                <view class="stat-item">
                  <image src="/images/icon-part.png" class="stat-icon"></image>
                  <text class="stat-text">{{survey.total_participants || 0}}</text>
                </view>
                <text class="create-time">{{survey.created_at}}</text>
              </view>
            </view>
          </view>
        </block>
      </block>
      <!-- 空状态 -->
      <view wx:else class="empty-state-wrapper">
        <empty-state show="{{true}}" type="empty" title="暂无投票" description="快去创建第一个投票吧" button-text="创建投票" show-button="{{false}}"></empty-state>
      </view>
    </view>
    <!-- 加载更多 -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner small"></view>
      <text class="loading-text">加载中...</text>
    </view>
    <!-- 没有更多数据 -->
    <view wx:elif="{{!hasMore && surveys.length > 0}}" class="no-more-data">
      <text>没有更多投票了</text>
    </view>
  </scroll-view>
</view>